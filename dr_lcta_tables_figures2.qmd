---
title: "A latent trajectory analysis in glycemic control and diabetic retinopathy screening coverage 2011-2023: A municipality-level study"
author:
  - name: Rolando Silva-Jorquera
    orcid: 0000-0002-1244-8350
    email: rolando.silva@pucv.cl
    affiliations:
      - name: University College London, Institute for Global Health, London, United Kingdom
  - name: Kasim Allel
    orcid: 0000-0002-2144-7181
    email: kasim.allel1@lshtm.ac.uk
    affiliations:
      - name: University of Oxford, Nuffield Department of Population Health, Oxford, United Kingdom
  - name: Hassan Haghparast-Bidgoli
    orcid: 0000-0001-6365-2944
    email: h.haghparast-bidgoli@ucl.ac.uk
    affiliations:
      - name: University College London, Institute for Global Health, London, United Kingdom
  - name: Paul Nderitu
    orcid: 0000-0002-8571-0751
    email: paul.nderitu@kcl.ac.uk
    affiliations:
      - name: Kingâ€™s College London, Section of Ophthalmology, Faculty of Life Sciences and Medicine, London, United Kingdom
      
      - name: Kingâ€™s College London, Department of Ophthalmology, Kingâ€™s Ophthalmology Research Unit (KORU), London, United Kingdom
  - name: Alasdair Warwick
    orcid: 0000-0002-0800-2890 
    email: alasdair.warwick.19@ucl.ac.uk
    affiliations:
      - name: NIHR Biomedical Research Centre, Moorfields Eye Hospital NHS Foundation Trust and UCL Institute of Ophthalmology, London, United Kingdom
      
      - name: UCL Institute of Cardiovascular Science, University College London, London, United Kingdom
  - name: Claudio Zett
    orcid: 0000-0003-1839-0927
    email: claudio.zett@pucv.cl
    affiliations:
      - name: Pontificia Universidad CatÃ³lica de ValparaÃ­so, ValparaÃ­so, Chile
format:
  html:
    toc: true
    toc_float: true
    toc_depth: 2
    number_sections: true
    code_folding: hide
    theme: readable
  pdf:
    number-sections: true
    colorlinks: true
    keeptex: true
    include-in-header: 
      text: |
        \usepackage{booktabs}
        \usepackage{siunitx}
        \newcolumntype{d}{S[
            input-open-uncertainty=,
            input-close-uncertainty=,
            parse-numbers = false,
            table-align-text-pre=false,
            table-align-text-post=false
         ]}
  docx: default
prefer-html: true
date: 'last-modified'
#date-format: '[This version:] MMMM D, YYYY [<br>(First version: February  16, 2023)]'
#abstract: "**Background:** Diabetes management in Chile varies from that in other countries. The Cardiovascular Program (PSCV) aims to control diabetes and retinopathy screening; however, this indicator has not been consistently monitored. Latent class mixture modeling was used to investigate the factors influencing membership in different subpopulations. **Aim**: This study analyzed PSCV data from 2011 to 2023 to identify unique trajectories in diabetes and diabetic retinopathy screening coverage (DMC and DRSC) among municipalities. The characteristics of deprivation were also examined. The analyses were conducted at the ecological level to identify municipalities with coverage differing from the national average or target. **Methods:** This study obtained data from the Statistical and Health Information Department on individuals with T2DM covered by the public health scheme, aged 15 years or above, and eligible for an annual eye examination in all 346 municipalities in Chile between 2011 and 2023. To have stronger analysis we remove the clasified municiplities by size of DM population, and the the lower quintil was removed.A linear Latent Class Mixed Model was used to derive trajectory classes for DRSC and DGCC, with six clusters identified based on clinical plausibility, model fit, and entropy criteria. Logistic regression was used to determine the impact of municipality characteristics on trajectory-class membership. This study focuses on interpreting the shape of clusters from a theoretical perspective. **Results:**  For each of the six models, the fit criteria were evaluated and the proportions in each trajectory class were calculated, along with the estimated intercepts and slopes for each class, with random effects across municipalities. The one-class model tested was a simple linear model with years predicting coverage and cluster membership, with intercepts representing baseline coverage and slopes indicating average annual change. The one-class model for DGC showed an average coverage of 45.10% at baseline with a small but significant negative slope, whereas the one-class model for DRS showed an average coverage of 28.45% with an annual increase of 1.59. Further analysis will focus on the DRSC's class membership, and the two-class model was preferred for DRSC over the one- and three-class models. In 2011, Class 1 (74.32% of municipalities) had an average coverage of 22.88% and experienced a gradual annual increase of 1.41% until 2023, whereas Class 2 (25.68%) had an average of 44.03% in 2011 and experienced a rapid annual increase of 2.07% until 2023. The unadjusted associations of socioeconomic index predictor factors with municipality DRSC trajectory provided an OR estimate of 0.531 (95% CI, 0.387â€“0.716), suggesting that as deprivation levels rise, the probability of achieving higher coverage (Class 2) increases. **Conclusion:** The DGCC in LAs in Chile appears to follow only a single trajectory, whereas the DRSC follows two slowly growing differing trajectories. Counterintuitively, the trajectories that followed did not appear to be influenced by deprivation. The group of municipalities following a higher DRSC trajectory is potentially worthy of further study to identify whether there are common local policies or practices that may have contributed to their positive deviance from national trends towards an increase in DRSC."
bibliography: references.bib
csl: vancouver-superscript.csl
tbl-cap-location: top
number-sections: true
editor:
  mode: source
execute:
  echo: false
  warning: true
  error: true
  cache: false
---

```{r}
#| message: false
#| echo: false
#| warning: false
#| paged-print: false
#| results: hide


# Load required libraries
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(purrr)
library(patchwork)
library(tidyverse) #dplyr, tibble, ggplot2, readr, tidyr, stringr, forcats, lubridate, purr
library(knitr)
library(kableExtra)
library(ggtext)
library(Cairo)
library(extrafont)
library(hrbrthemes)
library(directlabels)
library(ggrepel)
library(readxl)
library(extrafont)
library(scales)
library(ggsci)
library(lcmm)
library(MixAll)
require(kml)
require(traj)
require(lmerTest)
require(plyr)
require(psych)
require(fpc)
require(mclust)
require(rcompanion)
library(gridExtra)
library(tidyLPA)
library(MASS)
library(skimr)
library(gtExtras)
library(pander)
library(BayesFactor)
library(modelsummary)
library(gt)
library(gtsummary)
library(survival)
library(xtable)
library(skimr)
library(htmltools)
library(tibble)
library(LCTMtools)
library(grid)
library(rlang)
library(lmtest)
library(quarto)
library(nnet)
library(broom)


```

# Introduction

<!-- The Rising Burden of Diabetes and Diabetic Retinopathy-->

The global increase in diabetes mellitus (DM), particularly type 2 DM (T2DM), has placed an immense burden on healthcare systems worldwide.[@idf_2021] This strain is particularly pronounced in the management of vision-threatening complications arising from inadequate diabetic glycemic control (DGC). Diabetic retinopathy (DR) remains a leading cause of avoidable blindness and vision impairment among working-age adults and poses a critical public health challenge.[@burton_lancet_2021] In response, the World Health Organization (WHO) has emphasized the importance of robust diabetes management and care quality, including maintaining glycated hemoglobin (HbA1c) levels below 7%.[@who] This target aligns with the success observed in England, where a national diabetic retinopathy screening (DRS) program has significantly reduced DR as a cause of blindness in adults.[@liew_comparison_2014]

<!--Inequalities in Diabetes Management and Screening Coverage-->

Despite these efforts, many individuals with T2DM still face social and emotional distress,[@fenwick_social_2012] limited daily functioning and job opportunities,[@cooper_psychological_2020] and significant economic consequences of unmanaged DR and diabetes.[@pdb52_2019] In turn, these impacts profoundly affect quality of life.[@trento_quality_2013] However, access to effective diabetes management and DRS varies significantly across local regions, as seen in Chile, where inequalities in DRS coverage (DRSC) exist among municipalities.[@SILVA-JORQUERA2021; @guerrero-nÃºÃ±ez2017] Similar disparities have been documented in other countries, often influenced by socioeconomic factors, urbanicity, and geographic location,[@patel2022; @elek2021; @ravindranath2023; @davis2023; @rawlingschidi2024] which affect access to healthcare and policy implementation for diabetes management.[@guerrero-nÃºÃ±ez2017; @elek2021]

<!--Understanding Sub-population Heterogeneity in the Context of Inequalities-->

Addressing these inequalities in Chile requires a clear understanding of the variations in DRS coverage across municipalities. Chileâ€™s national guidelines established by the Cardiovascular Health Program call for regular HbA1c monitoring and annual DRS to prevent sight loss.[@minsal2017] However, there are considerable disparities in meeting these targets across different areas.[@SILVA-JORQUERA2021; @guerrero-nÃºÃ±ez2017] Identifying subpopulations with unique healthcare needs and understanding how factors such as demographics and socioeconomic status affect their healthcare trajectories could inform targeted interventions. Such efforts may ultimately improve local-level diabetes management and access to DRS.

<!--Latent Class Mixture Modeling: A Novel Approach-->

Traditional statistical approaches may overlook these population-level variations, often assuming a uniform response to diabetes management across the study population. Distinct subpopulations with unique trajectories for achieving adequate DGC and accessing DRS services are likely to exist. Latent class mixture modelling (LCMM) is an unsupervised machine learning technique that can identify these subpopulations based on observed characteristics.[@berlin_introduction_2014; @miettunen2016] However, to our knowledge, no prior studies have applied LCMM to explore subpopulation heterogeneity within the context of T2DM management and DRSC in Chile.

In this study, we applied LCMM to longitudinal data on T2DM management and DRS coverage in Chilean municipalities. Our aim was to reveal unique trajectory patterns in achieving a DGC, defined as an HbA1c target of\< 7% and access to the DRS. Additionally, we investigated how area-level demographics and deprivation characteristics correlate with these identified trajectories. Although conducted at an ecological level, our findings offer a novel approach to identifying municipalities that perform above or below the national average. These insights have the potential to guide future research and inform policy interventions to reduce sight loss and improve equity in diabetes management.

# Methods

## Study design and data sources

We conducted a retrospective observational study using annually reported municipality-level health data from 2011 to 2023. Although the data consist of repeated cross-sectional observations collected independently each year, they were analyzed longitudinally to capture temporal patterns and trajectories of care coverage across municipalities. To achieve this, we applied latent class mixed models (LCMM), a probabilistic approach that identifies distinct latent trajectories within heterogeneous populations and is well suited for repeated observations at the aggregate level.[@berlin_introduction_2014] This approach provided a solid foundation for assessing coverage patterns over time.

Our analysis focused on adults aged â‰¥15 years diagnosed with type 2 diabetes mellitus (T2DM) under the Chilean public health system, consistent with the age threshold established by national cardiovascular program guidelines. Data on T2DM care indicators were sourced from the Statistical and Health Information Department via the Chilean Public Health Platform.[@deis] The data were provided in a curated format as summary indicators at the health centre level and subsequently aggregated at the municipality level for analysis. These data sources laid out the basis for constructing outcomes indicators.

We examined two primary outcomes: diabetic glycemic control coverage (DGCC) and diabetic retinopathy screening coverage (DRSC). DGCC was defined as the proportion of T2DM patients achieving HbA1c \<7% among those monitored annually, while DRSC was defined as the proportion of T2DM patients receiving an annual retinopathy screening. These indicators reflect key aspects of quality in diabetes care provision, offering insight into both metabolic control and preventive screening efforts. It is also important to consider the scope and limitations of these indicators as represented in the dataset, since their interpretation depends on how each was operationalized in the data.

For DGCC, patients without HbA1c testing were excluded from the cardiovascular program after three unsuccessful contact attempts and were therefore not included in the dataset. As a result, the dataset includes only individuals with at least one recorded HbA1c measurement within the calendar year, and those without testing were not assumed to have HbA1c \>7%. This ensures that DGCC reflects actual glycemic control rather than assumptions about missing data. The inclusion process for DRSC was structured differently.

For DRSC, all diagnosed patients remained in the cardiovascular program regardless of whether they attended their annual diabetic retinopathy screening. Hence, all patients were retained in the denominator for this indicator. These inclusion criteria were established by the health system prior to data aggregation.

To improve representativeness, we excluded municipalities in the lowest population-size quintile. These smaller municipalities often exhibited extreme coverage percentages (e.g., 0% or 100%) due to the limited size of their T2DM populations, which could have disproportionately influenced overall estimates and introduced bias into the trajectory modeling. Excluding these municipalities minimized the risk of bias in trajectory estimation and provided a clearer understanding of the relationship between coverage trajectories and key municipal-level characteristics.

We also examined associations between trajectory membership and selected municipal-level characteristics in a second stage of the analysis. These characteristics included socioeconomic deprivation, urbanicity, and geographical location. Socioeconomic deprivation was measured using the Index of Socioeconomic Development (ISED), which incorporates indicators such as income, education, housing, and sanitation. [@gattini_comunas_2013] After excluding municipalities in the lowest quintile of diabetes population at municipal level, the ISED was standardized (mean = 0, SD = 1) across the remaining sample to facilitate comparability across municipalities. Urbanicity classification followed national guidelines and categorized municipalities as predominantly rural, mixed, or predominantly urban.[@bergamini2020] Geographical zones were defined using the classification of the Environmental Tribunals, which divide the country into northern, central, and southern zones.

## Missing data handling

The dataset was curated to minimize missing data through predefined inclusion rules established in advance by the health system. For DGCC, only individuals with at least one recorded HbA1c measurement within the calendar year were retained in the dataset; patients without testing after three failed contact attempts were excluded administratively, and not considered missing. For DRSC, all diagnosed patients remained in the cardiovascular program regardless of screening attendance, ensuring complete denominators. At the municipality level, we excluded units in the lowest quintile of diabetes population size to mitigate the impact of extreme values arising from unstable denominators. In the second-stage association models, no missing data were present in the municipal-level covariates (deprivation, urbanicity, and geographical zone), all of which were complete for the retained sample. As a result, all analyses were conducted on full-case data, and no imputation was required.

## Statistical analysis

We conducted a two-stage analysis to identify coverage trajectory patterns and examine their sociodemographic determinants.

In the first stage, we applied latent class mixed models (LCMM) to classify trajectories of DRSC and DGCC between 2011 and 2023. LCMM assigns individuals probabilistically to latent classes, each representing a distinct trajectory pattern within the population [@berlin_introduction_2014]. Ten model structures (A to J) from one to seven class-models were tested. In brief, these included homoscedastic and heteroscedastic models, as well as models with random intercepts or higher-order random effects. A grid search procedure was used to optimize model parameters, with initial values derived from the one-class model estimates. This method involved 200 random sets and a maximum of 1000 iterations to explore the parameter space efficiently.

In the second stage, we assessed whether key municipal-level characteristics were associated with class membership, using a modelling framework grounded in established approaches [@lennon2018]. This design enabled both the classification of coverage patterns and the exploration of contextual factors that may influence them.

The modelling process began with the specification of a linear fixed-effects model (Model A; see Supplementary Table S1**)**, which served as a scoping model to explore trajectory structures. We then evaluated patterns in the standardized residuals from these preliminary models to inform the selection of candidate model structures. Specifically, flat residuals suggested the need for a random intercept; linear trends pointed to a random slope; parabolic curves indicated a quadratic term; and more complex patterns suggested the inclusion of a cubic term.

Without prior studies suggesting a specific number of latent classes for these outcomes indicating which class models to use for evaluating residuals and identifying potential structures, we improved our selection method by examining BIC value plots alongside class proportions. We used inflection points, or "elbow bends," in these BIC curves to find a compromise between model complexity and goodness-of-fit, as recommended by Molenberghs and Verbeke.[@molenberghs_model_2009]Our hypothesis regarding the number of latent classes was based on these elbow plots, and we used residual patterns to guide the potential model structure. This approach laid the groundwork for choosing and refining the best model based on statistical fit and interpretability.

We refined our previously selected potential class-model and model structure by evaluating our selected class models across the ten structures presented in Supplementary Table S1. Then, a model adequacy was assessed using standard criteria: average posterior probability of assignment (APPA \>0.70), odds of correct classification (OCC \>5), relative entropy (\>0.6), mismatch values close to 0, and a minimum class size of 2% of the sample. The 2% threshold was set to ensure meaningful class interpretation in a moderately sized population. If the criteria were not met, the number of classes and model structure were adjusted to enhance classification quality and model fit, and we considered an alternative model with a higher BIC value. We also integrated clinical interpretability and plausibility considerations by reviewing the clinical relevance of latent class coverage patterns, ensuring that each class represented realistic and distinguishable variations in diabetes care provision.

As part of the model adequacy assessment, we also constructed elbow graphs for across the strucrure displaying the BIC values for each candidate model to visually examine the point at which model fit no longer substantially improved with the addition of more classes as we previously did for our scoping model (Model A). Although final model selection was guided primarily by the formal adequacy criteria described above, the elbow graphs served as a complementary heuristic to prioritize statistically robust and parsimonious solutions. Elbow plots were reviewed across all candidate structures before final selection. Once the number of classes and model structure were finalized and deemed adequate, we proceeded to visualize the model outcomes trajectories.

We used three graphical presentation approaches to visualize model outcomes. The conventional approach involved plotting mean trajectories with time for each class. Additionally, we used mean trajectory plots with 95% predictive intervals for each class, which display the predicted random variation within each class. Another approach was to plot individual-level "spaghetti plots" with time (e.g., using a random sample of participants), allowing the reader to observe changes within classes over time. These three graphical techniques helped provide a comprehensive understanding of the class-specific trajectories. We have also used additional tools for model discrimination.

We use degrees of separation to discriminate the separation of the mean trajectories across latent classes. We applied multivariate Mahalanobis distance to help identifying heterogeneous latent trajectories. Thus, higher DoSK values indicate well-separated mean trajectories, while a DoSK of zero indicates identical trajectories suggesting selection for alternative models with fewer classes.

We use an additional tool to asses the structure of our model trough Elsensohnâ€™s envelope of residuals. To assess the adequacy of model structure assumptions, we implemented a residual-based diagnostic approach originally proposed by Elsenhohn et al. for fixed-effects latent class models and subsequently extended by Lennon et al. to accommodate random effects specifications. For each time point and class, we computed the weighted mean of the predicted coverage values using individualsâ€™ posterior probabilities of class membership as weights. In parallel, we estimated the class-specific and time-specific weighted standard deviation of subject-specific residuals, centered around the weighted mean of residuals. These standard deviations were used to construct upper and lower envelopes (+- 1 SD) around the mean trajectories as a basis for graphical representation of model fit and class-specific uncertainty.

This graphical tool provides a visual assessment of the modelâ€™s structure adequacy. Non-parallel boundaries may indicate heteroscedasticity of residuals, while markedly varying interval widths may suggest that within-class heterogeneity is not fully captured. This method is suitable for both fixed- and random-effects latent class trajectory models and contributes to identifying -or confirming - the optimal model structure.

After identifying the optimal model structure, we proceeded with assigning descriptive labels to the latent trajectory classes. Each class was categorized based on observed coverage patterns. This process involved reviewing class-specific characteristics to ensure that each label was meaningful and aligned with plausible real-world patterns. These labels provided a framework for understanding the different patterns of diabetes coverage provision, guiding further interpretation and analysis. Following this, we assessed the robustness of the model by conducting sensitivity analyses.

To assess the robustness of the latent class trajectory classifications, we conducted sensitivity analyses by replicating the modeling on a restricted sample of individuals with at least three observed time points. This threshold ensured sufficient longitudinal information per participant to support reliable class assignment.Â Agreement between classifications in the full sample and the restricted sample will be quantified using Cohenâ€™s kappa coefficient, providing an objective measure of stability. This diagnostic step allows us to evaluate whether the favored model remains consistent across subsamples, thereby strengthening confidence in its validity and generalizability. After this step, we will assess the interpretability of the favored model by examining potential influential factors.

In the second stage, we examined whether municipality-level characteristics (deprivation, urbanicity, and geographical location) predicted class membership using lineal regression model. The ISED score was standardized to meet distributional assumptions, and both unadjusted and adjusted models were fitted to evaluate the strength and consistency of these associations.

All analyses were conducted in R version 4.4.2, with latent class trajectory modelling performed using theâ€¯`lcmm`â€¯package (version 2.1.0). Additional data processing and visualization tasks were supported by other R packages as appropriate.

All syntax files and documentation used in the analysis are available via a public GitHub repository **\[GitHub link\].**

This study adhered to theÂ Guidelines for Reporting on Latent Trajectory Studies (GRoLTS)Â to ensure transparency and replicability in reporting [@vandeschoot2016].

## Ethics, Funding and Public Involvement

This study was based on publicly available, aggregate municipality-level data without individual identifiers; therefore, ethical approval was not required. Patients or members of the public were not involved in the design, conduct, or analysis of this study. We plan to disseminate the findings through academic conferences and by engaging with public policy stakeholders and health authorities to support evidence-informed decision-making.

# Results

## Overview of DGCC and DRSC Latent Class Trajectory Estimation

Of the 346 municipalities with available data, we excluded those in the lowest quintile of diabetes population size (n = 46) to improve representativeness and reduce the influence of unstable denominators. As a result, 300 municipalities were retained for the 2011â€“2023 analyses.

### Scoping models and initial trajectory structures

Scoping models using linear fixed-effects structures (Model A) suggested that a four-class structure offered the best balance between parsimony and fit across all combinations of outcome (DGCC or DRSC). BIC plots consistently displayed an inflection point - where the elbow bends - at four classes for Model A , beyond which improvements in model fit were marginal (Supplementary Figures S2â€“S5). Standardized residuals from one-class linear models showed quadratic and cubic patterns supporting the need to explore higher-order strucrures in subsequent steps. These findings jointly supported the four-class trajectory models as a theoretically plausible and statistically grounded starting point for refinement.

### Number of latent classes

Building on the exploratory results, we formally compared latent class solutions ranging from one to seven classes across ten candidate model structures: quadratic, cubic, and proportional random effects. The comparison relied exclusively on BIC values, which consistently supported a four-class solution across all outcome-period combinations (Supplementary Table S3). In each case, BIC curves exhibited a marked elbow at four classes, indicating diminishing returns in model fit beyond that point. This convergence reinforced the choice of four classes as the optimal structure for further model testing.

### Model structure refinement

Using the four-class structure as a basis, we tested ten predefined model variants (Structures Aâ€“J), each differing in functional form (linear, quadratic, cubic), random effects specification, and error variance assumptions. For DGCC and DRSC, Structure D (cubic, fixed effects) was retained as the best-performing structures meeting adequacy thresholds (see Supplementary Table S4).

### Model adequacy assesment and plausibility

The selected models met the predefined adequacy thresholds, including relative entropy â‰¥ 0.67, average posterior probability of assignment (APPA) \> 0.70, odds of correct classification (OCC) \> 5, and mismatch values near zero, with no class representing less than 2% of the sample. Models resulting in highly imbalanced class distributions (e.g., 93% in one class and 7% in another) were rejected because they failed to represent plausible variations in care coverage. Both outcomes demonstrated adequate classification quality: DGCC models achieved high OCC scores (8.1â€“11.7) and entropy values (0.83â€“0.85), while DRSC models reached acceptable OCC levels (5.5â€“9.5) and entropy between 0.67 and 0.79. Supplementary Figures S3â€“S6 show that all retained models displayed a clear elbow point at four classes, reinforcing this structure as statistically parsimonious and theoretically meaningful.

### Graphical presentations

We produced graphical representations of latent class trajectories to aid interpretation. Figure 1 shows the estimated mean coverage across time for each outcome, while Figure 2 displays class-specific trajectories from the selected latent class models. These included: Model DÂ (cubic without random effects) for DGCC 2011â€“2023,Â Model CÂ (quadratic without random effects) for DGCC 2011â€“2019,Â Model D(cubic without random effects) for DRSC 2011â€“2023, andÂ Model GÂ (quadratic with random intercept and slope) for DRSC 2011â€“2019. Each trajectory plot illustrates distinct temporal patterns of coverage across latent subgroups, highlighting heterogeneity in trends and class differentiation.

To complement these summary plots, we generated spaghetti graphs using individual-level data for each retained model (Supplementary Figure S7), showing the distribution and dispersion of observed coverage trajectories within each latent class. These visualisations enhance interpretability by illustrating the internal variability of trajectories and the degree of within-class cohesion over time.

### Additionals discrimination tools

To evaluate the adequacy of the model structure, we applied Elsensohnâ€™s envelope of residuals diagnostic tool. The envelope plots, displayed in **Supplementary Figure S7**, represent the mean trajectory of each latent class with upper and lower boundaries indicating the range of residuals (Â±1 SD). These plots visually assessed the fit of the model at each time point and latent class.

For the majority of classes, the envelope boundaries were relatively parallel, indicating that the model effectively captured the variation in coverage. However, some classes exhibited non-parallel boundaries, suggesting slight heteroscedasticity, where the variability of residuals increased or decreased over time. Additionally, some classes showed varying widths in the envelopes, which may indicate unaccounted-for within-class heterogeneity.

These envelope plots confirmed that the model structure was largely adequate, although minor adjustments may be considered for classes with notable residual heterogeneity.

For both DRSC and DGCC, the calculated degrees of separation values were consistently high, indicating well-separated classes. This suggests that the latent classes represent distinct and meaningful variations in diabetes care coverage across municipalities. Lower degrees of separation values observed in a few classes signified possible overlap in trajectory patterns, which was further assessed through model refinement.

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-height: 4.5
#| fig-width: 10
#| paged-print: false
#| fig-cap: "**Figure 1. Overall mean coverage of glycaemic control and diabetic retinopathy screening across Chilean municipalities (2011â€“2023).** The plots display average annual coverage trends, calculated at the municipal level, for HbA1c control (left) and DR screening (right), excluding municipalities in the lowest quintile of diabetes population. The dashed red line indicates the 80% coverage benchmark used as a policy-relevant threshold."

library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(purrr)
library(patchwork)
library(tidyverse) #dplyr, tibble, ggplot2, readr, tidyr, stringr, forcats, lubridate, purr
library(knitr)
library(kableExtra)
library(ggtext)
library(Cairo)
library(extrafont)
library(hrbrthemes)
library(directlabels)
library(ggrepel)
library(readxl)
library(extrafont)
library(scales)
library(ggsci)
library(lcmm)
library(MixAll)
require(kml)
require(traj)
require(lmerTest)
require(plyr)
require(psych)
require(fpc)
require(mclust)
require(rcompanion)
library(gridExtra)
library(tidyLPA)
library(MASS)
library(broom)
library(skimr)
library(gtExtras)
library(pander)
library(BayesFactor)
library(modelsummary)
library(gt)
library(gtsummary)
library(survival)
library(xtable)
library(skimr)
library(htmltools)
library(tibble)
library(LCTMtools)
library(grid)
library(rlang)
library(lmtest)


# Datos
coverage_data <- read.csv("coverage_data.csv")


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“Š 1. General trends (no latent classes)

general_dm_trend <- coverage_data %>%
  group_by(year) %>%
  dplyr::summarise(
    mean_coverage = mean(dgcc, na.rm = TRUE),
    sd_coverage = sd(dgcc, na.rm = TRUE),
    n_coverage = n(),
    se_mean = sd_coverage / sqrt(n_coverage),
    margin_error = 1.96 * se_mean,
    lower_ci = mean_coverage - margin_error,
    upper_ci = mean_coverage + margin_error,
    .groups = "drop"
  )

general_drs_trend <- coverage_data %>%
  group_by(year) %>%
  dplyr::summarise(
    mean_coverage = mean(drsc, na.rm = TRUE),
    sd_coverage = sd(drsc, na.rm = TRUE),
    n_coverage = n(),
    se_mean = sd_coverage / sqrt(n_coverage),
    margin_error = 1.96 * se_mean,
    lower_ci = mean_coverage - margin_error,
    upper_ci = mean_coverage + margin_error,
    .groups = "drop"
  )

plot_dm <- ggplot(general_dm_trend, aes(x = year, y = mean_coverage)) +
  geom_line(color = "red", linewidth = 0.3) +
  geom_point(size =1.5, color = "red") +
  geom_errorbar(aes(ymin = lower_ci, ymax = upper_ci), width = 0.25, color = "red") +
  geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
  scale_x_continuous(breaks = seq(1, 13, by = 2), labels = seq(2011, 2023, by =2)) +
  scale_y_continuous(limits = c(0, 1), labels = percent) +
  labs(x="Year", y = "Average glycaemic coverage") +
  theme_bw() +
  theme(
    legend.position = "none",
    axis.text = element_text(size = 9),
    axis.title = element_text(size = 9),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )

plot_drs <- ggplot(general_drs_trend, aes(x = year, y = mean_coverage)) +
  geom_line(color = "red", linewidth = 0.3) +
  geom_point(size = 1.5, color = "red") +
  geom_errorbar(aes(ymin = lower_ci, ymax = upper_ci), width = 0.25, color = "red") +
  geom_hline(yintercept = 0.8, linetype = "dashed", color = "red") +
  scale_x_continuous(breaks = seq(1, 13, by = 2), labels = seq(2011, 2023, by =2)) +
  scale_y_continuous(limits = c(0, 1), labels = percent) +
  labs(x="Year", y = "Average DR screening coverage") +
  theme_bw() +
  theme(
    legend.position = "none",
    axis.text = element_text(size =9),
    axis.title = element_text(size = 9),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )

# Titles as text grobs
dgcc_title <- wrap_elements(grid::textGrob(
  "Diabetic glycaemic control coverage", 
  x = 0, hjust = 0, gp = gpar(fontface = "bold", fontsize = 13)
))

drsc_title <- wrap_elements(grid::textGrob(
  "Diabetic retinopathy screening coverage", 
  x = 0, hjust = 0, gp = gpar(fontface = "bold", fontsize = 13)
))

# Combine each title + plot with reduced spacing
dgcc_block <- dgcc_title / plot_dm + plot_layout(heights = c(0.1, 1))
drsc_block <- drsc_title / plot_drs + plot_layout(heights = c(0.1, 1))

# Final combination
combined_trends <- dgcc_block | drsc_block

# Optional overall annotation
combined_trends <- combined_trends +
  plot_annotation(
    theme = theme(
      plot.title = element_text(size = 14, face = "bold"),
      plot.subtitle = element_text(size = 10)
    )
  )

# Display
combined_trends




```

```{r}
#| message: false
#| echo: false
#| warning: false
#| paged-print: false
#| fig-height: 9
#| fig-width: 10
#| fig-align: left
#| fig-cap: "**Figure 2. Latent trajectories of observed mean glycaemic control and diabetic retinopathy screening coverage across Chilean municipalities.** The left column presents plots for glycaemic control (HbA1c < 7%), and the right column for annual DR screening. The plots at the top are based on data from 2011 to 2023, while those below use data restricted to the 2011â€“2019 period. Each panel displays average annual coverage with 95% confidence intervals, stratified by latent classes identified through longitudinal mixture modeling. The dashed red line indicates the 80% coverage threshold used as a policy benchmark. Municipalities in the lowest quintile of diabetes coverage were excluded from the analysis."

model_titles <- c(
  "5class_cubic_nre_dgcc_model_2011_2023" = "Five-class model in Model D structure for glycaemic control coverage (2011â€“2023)",
  "4class_cubic_nre_drsc_model_2011_2023" = "Four-class model in Model D structure for DR screening coverage (2011â€“2023)"
)



# Modelos (ya sin sufijos)
all_named_models <- readRDS("all_named_models.rds")


# Reatacha la data 2011â€“2023 a cada modelo
for (nm in names(all_named_models)) {
  if (!is.null(all_named_models[[nm]])) {
    all_named_models[[nm]]$call$data <- coverage_data
  }
}

# (Opcional) guarda una copia â€œlimpiaâ€
# saveRDS(all_named_models, "all_named_models_clean_2011_2023_only.rds")


# Trajectory labels

trajectory_labels <- list(
  "5class_cubic_nre_dgcc_model" = c(
    "Consistently lower", "Stable medium", "Stable upper medium", "Deteriorating", "Highest"
  ),
  "4class_cubic_nre_drsc_model" = c(
    "Consistently low", "Stable medium", "Increasing", "Highest decreasing"
  )
)

model_names_to_plot <- c(
  "5class_cubic_nre_dgcc_model",
  "4class_cubic_nre_drsc_model"
)




selected_models <- all_named_models[model_names_to_plot]
plot_list <- list()
all_merged_df <- list()

for (i in seq_along(selected_models)) {
  model_name <- names(selected_models)[i]
  model <- selected_models[[model_name]]
  stopifnot(!is.null(model$call$data), !is.null(model$pred), !is.null(model$pprob))

  outcome_var <- dplyr::case_when(
    grepl("drsc", model_name, ignore.case = TRUE) ~ "drsc",
    grepl("dgcc", model_name, ignore.case = TRUE) ~ "dgcc",
    TRUE ~ NA_character_
  )
  stopifnot(!is.na(outcome_var), outcome_var %in% names(model$call$data))

  v <- rlang::sym(outcome_var)  # â† usamos !!v en vez de .data[[...]]

  model_data <- model$call$data %>%
    dplyr::group_by(id) %>% dplyr::mutate(row_id = dplyr::row_number()) %>% dplyr::ungroup()

  pred_df <- model$pred %>%
    dplyr::group_by(id) %>% dplyr::mutate(row_id = dplyr::row_number()) %>% dplyr::ungroup()

  merged_df <- dplyr::left_join(model_data, pred_df, by = c("id","row_id")) %>%
    dplyr::left_join(model$pprob, by = "id") %>%
    dplyr::filter(!is.na(class))

  summary_data <- merged_df %>%
    dplyr::group_by(year, class) %>%
    dplyr::summarise(
      mean_coverage = mean(!!v, na.rm = TRUE),
      sd_coverage   = stats::sd(!!v, na.rm = TRUE),
      n_coverage    = dplyr::n(),
      .groups = "drop"
    ) %>%
    dplyr::mutate(
      se_mean  = sd_coverage / sqrt(n_coverage),
      lower_ci = mean_coverage - 1.96 * se_mean,
      upper_ci = mean_coverage + 1.96 * se_mean
    )

  # Orden lÃ³gico de clases (bajaâ†’alta)
  class_order <- merged_df %>%
    dplyr::group_by(class) %>%
    dplyr::summarise(mean_value = mean(!!v, na.rm = TRUE), .groups = "drop") %>%
    dplyr::arrange(mean_value) %>% dplyr::mutate(class_order = dplyr::row_number())

  merged_df   <- merged_df   %>% dplyr::left_join(class_order, by = "class") %>%
    dplyr::mutate(class = class_order) %>% dplyr::select(-class_order)

  summary_data <- summary_data %>% dplyr::left_join(class_order, by = "class") %>%
    dplyr::mutate(class = class_order) %>% dplyr::select(-class_order)

  # Etiquetas con % por clase
  class_percentages <- merged_df %>%
    dplyr::distinct(id, class) %>%
    dplyr::group_by(class) %>%
    dplyr::summarise(n = dplyr::n(), .groups = "drop") %>%
    dplyr::mutate(percentage = n / sum(n)) %>%
    dplyr::arrange(class)

  labels_vec <- trajectory_labels[[model_name]]
  if (is.null(labels_vec) || length(labels_vec) != nrow(class_percentages)) {
    labels_vec <- paste0("Class ", seq_len(nrow(class_percentages)))
  }
  legend_labels <- paste0(labels_vec, " (", scales::percent(class_percentages$percentage, accuracy = 0.1), ")")

  y_axis_label <- if (grepl("dgcc", model_name, ignore.case = TRUE)) {
    "Proportion of T2DM individuals with HbA1c < 7%"
  } else {
    "Proportion of T2DM individuals with annual DR screening"
  }

  p <- ggplot2::ggplot(merged_df, ggplot2::aes(x = year, colour = as.factor(class))) +
    ggplot2::geom_line(data = summary_data, ggplot2::aes(y = mean_coverage), linewidth = 0.3) +
    ggplot2::geom_point(data = summary_data, ggplot2::aes(y = mean_coverage), size = 0.7) +
    ggplot2::geom_errorbar(data = summary_data, ggplot2::aes(ymin = lower_ci, ymax = upper_ci), width = 0.25) +
    ggplot2::scale_x_continuous(breaks = seq(1,13,2), labels = seq(2011,2023,2)) +
    ggplot2::scale_y_continuous(limits = c(0,1), breaks = seq(0,1,0.2), labels = scales::percent) +
    ggplot2::geom_hline(yintercept = 0.8, linetype = "dashed") +
    ggplot2::xlab("Year") + ggplot2::ylab(y_axis_label) +
    ggplot2::theme_bw() +
    ggsci::scale_color_lancet(labels = legend_labels, na.translate = FALSE) +
    ggplot2::labs(color = "Latent class") +
    ggplot2::guides(color = ggplot2::guide_legend(nrow = 2, byrow = TRUE, title.position = "top", title.hjust = 0)) +
    ggplot2::theme(
      legend.position = c(0.02, 0.98), legend.justification = c(0,1),
      legend.direction = "horizontal", legend.box = "horizontal",
      legend.key.size = grid::unit(0.2, "cm"),
      legend.background = ggplot2::element_rect(fill = "transparent", color = NA),
      legend.text = ggplot2::element_text(size = 7),
      legend.title = ggplot2::element_text(size = 8, face = "bold"),
      axis.text = ggplot2::element_text(size = 6.2),
      axis.title = ggplot2::element_text(size = 7.5, face = "bold"),
      panel.grid.major = ggplot2::element_blank(),
      panel.grid.minor = ggplot2::element_blank()
    )

  all_merged_df[[model_name]] <- merged_df
  plot_list[[i]] <- p
}

# ComposiciÃ³n dos paneles
dgcc_title <- patchwork::wrap_elements(grid::textGrob(
  "Diabetic glycaemic control coverage (2011â€“2023)", x = 0, hjust = 0, gp = grid::gpar(fontface = "bold", fontsize = 13)
))
drsc_title <- patchwork::wrap_elements(grid::textGrob(
  "Diabetic retinopathy screening coverage (2011â€“2023)", x = 0, hjust = 0, gp = grid::gpar(fontface = "bold", fontsize = 13)
))

combined_plot <- (dgcc_title / plot_list[[1]]) | (drsc_title / plot_list[[2]])
combined_plot <- combined_plot + patchwork::plot_layout(heights = c(0.1, 1))
combined_plot





```

```{r}
#| echo: false
#| message: false
#| warning: false


# ðŸ“‚ 1. Cargar datos
coverage_data <- read_csv("coverage_data.csv")
all_named_models <- readRDS("all_named_models.rds")
demographics <- read_csv("demographics.csv") %>%
  mutate(
    deprivation_index = index_standardized,
    urbanisation_classification = factor(urbanisation_classification, levels = c("Urban", "Mixed", "Rural")),
    zone = factor(zona, levels = c("Centre", "North", "South"))
  ) %>% 
  select(comuna, deprivation_index, urbanisation_classification, zona) %>% 
  drop_na() 



# Asignar coverage_data a modelos
for (model_name in names(all_named_models)) {
  all_named_models[[model_name]]$call$data <- coverage_data 
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“‹ 3. Preparar merged_df de cada modelo
all_merged_df <- list()

for (model_name in names(all_named_models)) {
  model <- all_named_models[[model_name]]
  
  if (!is.null(model$call$data) && !is.null(model$pred) && !is.null(model$pprob)) {
    model_data <- model$call$data %>%
      group_by(id) %>%
      mutate(row_id = row_number()) %>%
      ungroup()
    
    pred_df <- model$pred %>%
      group_by(id) %>%
      mutate(row_id = row_number()) %>%
      ungroup()
    
    merged_df <- left_join(model_data, pred_df, by = c("id", "row_id")) %>%
      left_join(model$pprob, by = "id") %>%
      filter(!is.na(class))
    
    outcome_var <- ifelse(grepl("drsc", model_name), "drsc", "dgcc")
    
    class_order <- merged_df %>%
      group_by(class) %>%
      dplyr::summarise(mean_value = mean(.data[[outcome_var]], na.rm = TRUE), .groups = "drop") %>%
      arrange(mean_value) %>%
      mutate(class_order = row_number())
    
    merged_df <- merged_df %>%
      left_join(class_order, by = "class") %>%
      mutate(class = class_order) %>%
      select(-class_order)
    
    all_merged_df[[model_name]] <- merged_df
  }
}

# Escoge uno de los modelos que quieras usar para construir la tabla descriptiva
model_name_to_use <- "5class_cubic_nre_dgcc_model"

df <- all_merged_df[[model_name_to_use]] %>%
  distinct(comuna, class) %>%
  left_join(demographics, by = "comuna")  # AsegÃºrate que matchÃ©e correctamente

# Ajustar formato para tabla
df <- df %>%
  mutate(class = as.factor(class))

library(gtsummary)
library(dplyr)
library(nnet)  # para multinom()

# Paso 1: crear modelo multinomial completo
model_multinom <- multinom(class ~ deprivation_index + urbanisation_classification + zona, data = df, trace = FALSE)

# Paso 2: calcular p-values manualmente con Likelihood Ratio Test (LRT)
covariates <- c("deprivation_index", "urbanisation_classification", "zona")
p_values_table <- data.frame(variable = character(), p.value = numeric())

for (var in covariates) {
  reduced_formula <- as.formula(
    paste("class ~", paste(setdiff(covariates, var), collapse = " + "))
  )
  reduced_model <- multinom(reduced_formula, data = df, trace = FALSE)
  
  ll_full <- logLik(model_multinom)
  ll_reduced <- logLik(reduced_model)
  
  LRT_stat <- 2 * (as.numeric(ll_full) - as.numeric(ll_reduced))
  df_diff <- attr(ll_full, "df") - attr(ll_reduced, "df")
  
  p_val <- pchisq(LRT_stat, df = df_diff, lower.tail = FALSE)
  
  p_values_table <- rbind(p_values_table, data.frame(variable = var, p.value = p_val))
}



# Paso 1: crear tabla descriptiva
descriptive_table <- df %>%
  select(class, all_of(c("deprivation_index", "urbanisation_classification", "zona"))) %>%
  tbl_summary(
    by = class,
    statistic = list(
      all_categorical() ~ "{n} ({p}%)",
      all_continuous() ~ "{median} ({p25}, {p75})"
    ),
    missing = "no",
    percent = "column"
  ) %>%
  modify_caption("**Table 1. Membership in each latent class group according to key demographics**") %>%
  bold_labels()

# Paso 1: Filtrar solo la fila principal por variable (es decir, row_type == "label") y unir con p-values

descriptive_table$table_body <- p_values_table %>% 
  dplyr::rename(label = variable) %>% 
  right_join(descriptive_table$table_body, by ="label") %>% 
  select(-p.value, everything(), p.value) %>% 
  arrange(variable) 
  
descriptive_table$table_body %>% 
  select(-variable, -var_type,	-row_type,	-var_label) %>% 
  dplyr::rename("Consistently lower" =stat_1, 
         "Stable medium"= stat_2, 
         "Stable upper medium" =stat_3, 
         "Deteriorating" = stat_4, 
         "Highest" = stat_5, 
         "p-value"= p.value) %>% 
gt() %>%
  tab_options(
    table.font.size = 10,
    data_row.padding = px(0),
    table.border.top.color = "black",
    heading.border.bottom.color = "black",
    row_group.border.top.color = "black",
    row_group.border.bottom.color = "white",
    table.border.bottom.color = "white",
    column_labels.border.top.color = "black",
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.color = "black",
    table_body.hlines.color = "white"
  )  %>% 
  tab_header(
    title = md("**Supplementary Table S9. Membership in each latent class group according to key demographicst**"))
```

# Discussions

## Summary of Key Findings

We used unsupervised machine learning to identify different subpopulation trajectory patterns for DGCC and DRSC in Chilean municipalities over 12 years. For both the 2011-2023 and 2011-2019 periods, the trajectory patterns for DRSC revealed two distinct patterns. The first depicted municipalities with stable baseline coverage levels, hovering at 27.85% (SE: 2.51) in the 2011-2023 period and slightly lower at 23.05% (SE=1.65%) in the 2011-2019 period. The second trajectory consistently showed higher baseline coverage levels, at 42.14% in the 2011-2023 period and 43.58% in the 2011-2019 period, with significant annual increases in coverage ranging from 1-2%.

Higher deprivation levels (less deprived) were consistently associated with lower DRSC. Rural areas generally showed better coverage than mixed urban environments, while urban areas displayed mixed results. Geographically, municipalities in the southern region consistently exhibited higher DRSC odds ratios compared to the central region. In the adjusted analysis, the influence of urbanicity emerged as the most salient predictor, with rural areas consistently demonstrating higher odds of better coverage.

## What is already known on this topic

Using the same dataset, we have identified significant variation in linear trends in DRSC between Chilean municipalities over the past decade. On the one hand, while deprivation is a predictor for poor uptake, the use of telemedicine has been shown to improve access to diabetic eye care in underserved communities, which often include deprived areas.[@rawlingschid2024] Deprivation affects not only the ability to afford healthcare but also the availability and utilization of services, as it is often associated with geographic isolation and limited healthcare infrastructure.[@lewandohundt2012] This technique has increased interest in health services for obesity,[@viner2018] food addiction,[@aloi2024] loneliness in adolescence,[@verboon2022] risk patterns of myopia[@li2023], or treatment of substance addiction disorders.[@bÃ³rquez2024]

In our study, we found that areas characterized by higher levels of deprivation surprisingly exhibited better DRSC. This unexpected finding challenges conventional assumptions and suggests that despite facing socioeconomic challenges, these areas may have prioritized healthcare resources towards DRS services. Possible explanations could include targeted healthcare interventions, focused on the importance of regular screening in deprived communities. Certainly, the use of telemedicine and the adoption of more than 150 primary eye-care units across the country may play a significant role. Deprivation may still be relevant in understanding DRS coverage, but its independent effect may be better explained by other factors included in the model as urbanicity. In fact, deprivation lost its significance after adjusting for urbanicity. While some studies indicate that rural areas may have lower screening coverage compared to urban areas,[@tÃ³th2019] other initiatives have demonstrated the feasibility and effectiveness of targeted screening programs in rural settings, [@hall2022; @khou2021] suggesting that targeted interventions can overcome barriers to screening coverage.[@hall2022] In other words, while socioeconomic status alone may be associated with higher coverage membership, its effect is mediated or influenced by factors such as rural/urban level.

The trajectories of DGCC and DRSC were observed to differ from one another. We found DGCC to present a single trajectory encompassing all 301 municipalities, whereas DRSC was characterized by two probable trajectories without significant slopes between 2011 and 2023. While the overall trend for DGCC indicated a decreasing adequate glycemic control over time, the DRSC trajectories showed an increasing trend, albeit still far from an ideal target - 80% in coverage- to tackle sight loss to long term as been reported.[@Scanlon_2017] It should be noted that the COVID-19 pandemic may have had a disruptive impact on healthcare services, including diabetes monitoring and screening,[@ahmed2021] and could have influenced trend analyses. Excluding the pandemic period yielded consistent results but with significant changes in trajectories over time for the DRSC. It is important to exercise caution when interpreting longitudinal trends that may have been influenced by pandemic data, as demonstrated by our sensitivity analyses.

In the unadjusted analysis, we observed a significant association between the standardized ISED and class membership. This finding underscores the importance of considering the socioeconomic status, as represented by the standardized index, in predicting membership in the higher coverage class. The standardized index serves as a proxy for various socioeconomic factors that may influence an individual's access to healthcare services, such as income level, education, and employment status.

However, when we adjusted for multiple variables, including classification type and zona, the significance of the association between the standardized index and class membership disappeared. This suggests that the predictive power of the standardized index is confounded by the inclusion of other factors.

For example, individuals classified as Rural may have lower socioeconomic status on average compared to those classified as Urban, which could contribute to the observed association between the standardized index and class membership. However, once we account for the Rural classification in the multivariate analysis, the direct effect of the standardized index becomes less significant. This indicates that much of the variation in higher coverage membership explained by socioeconomic status is already captured by the classification variable.

Therefore, while the standardized index provides valuable insight into the socioeconomic determinants of higher coverage membership, its significance in predicting membership diminishes when other relevant factors are taken into consideration. This highlights the need for comprehensive multivariate analyses to better understand the complex interplay between socioeconomic status and other predictors of healthcare coverage.

Interestingly, higher levels of deprivation did not lead to less favorable trajectories for municipalities. Instead, they were associated with an increased likelihood of a high DRSC coverage. This association is particularly pronounced between the period 2011-2019. Although it remained highly significant in the 2011-2023 timeframe, the OR exhibited a smoother association, robustly supporting our findings. On the other hand, unadjusted association with urbanicity and their three categories showed that the Urban population is the less favourable in achieving the highuer coverage trajectory, meanwhile Rural population the most favourable, though non statistically significant. It seems urbanisation could explain better the association with DRSC trajectories than deprivation as this lost its significant effect when we adjusted by urbanisation level. Therefore, understanding the factors that influence DRSC is crucial. Future research should explore these practical implications. Potentially, factors linked to targeted health policies addressing diabetes within Chile's 2005 health reform[@bastias2008] and financing primary healthcare based on factors such as deprivation through capitation[@cuadrado2022] could provide insights and explain, at least in part, our findings.

To date, there is no evidence of the use of LCMM techniques to investigate geographical differences in the DRSC in Chile or other regions. Similar evidence has explored obesity prevalence in childhood across local authorities in the UK, highlighting its significance in studying geographical data to inform policies.[@viner2018] Despite previous discussions, no studies at the municipal level have used mixed-effect models or LCMM techniques to identify unique trends in the DRSC. LCMM methods enable the identification of municipalities that demonstrate exceptional progress in longitudinal trends for sight-loss-related diabetes prevention, enhance the understanding of geographical inequalities, and inform targeted interventions to improve screening coverage.

Utilizing PSCV data from more than a decade, we successfully identified distinct subpopulations of municipalities that exhibited varying trajectories in the DRSC. Most municipalities displayed a high probability of belonging to their designated classes, suggesting a strong alignment between these assigned classes and DRSC from 2011 to 2023. However, some municipalities exhibited notably lower probabilities of being assigned to the DRSC classes, indicating potential inaccuracies. Although our analyses were conducted at the ecological (municipality-level) rather than at the individual level (T2DM patient), this approach was considered appropriate as a key determinant of healthcare access for DRSC often operating at the primary healthcare level. Our primary objective was to identify the potential subpopulations among municipalities. Nevertheless, we could not establish causality for the relationships identified between socioeconomic deprivation and municipality trajectory classes.

While the trajectory classes we identified are plausible, LCMM is an exploratory, data-driven technique, and chance relationships in our data may have influenced our findings regarding trajectory groups. However, we were cautious in identifying the most likely latent class groups and the trajectories we identified were reasonable. The southern regions exhibited a notable trend, with a higher likelihood of falling into the upper DRSC category, suggesting distinct regional patterns potentially influenced by socioeconomic conditions or healthcare accessibility in these areas. Further investigation into the impact of regional policies on DRSC access could be beneficial, encompassing factors such as the availability of eye care specialists, the implementation of mobile clinics for underserved populations, and targeted initiatives to enhance access in less advantaged regions. These area-specific efforts could play a crucial role in broadening screening coverage and mitigating regional healthcare inequalities.

Our data on municipality deprivation took place in 2013, but we hypothesized that it is possible that the overall deprivation levels remained relatively stable over the thirteen-year (and nine-year) study period. Nonetheless, trajectory class membership may have been influenced by changes in deprivation levels during the study period.

# Conclusions

The existence of DGCC in Chilean municipalities appears to follow a single trajectory, whereas the DRSC presents two distinct, gradually increasing trajectories after testing the pandemic period. Higher deprivation levels (lower ISED score) were associated with an increased likelihood of higher DRSC trajectory. It is worthwhile to examine municipalities that demonstrate a higher DRSC trajectory (see [supplementary data](https://github.com/Rolo-Silva/trajectories_diabetes)) in greater detail to identify any shared local policies or practices that may contribute to their positive deviation from national trends in DRSC increase. Future studies should investigate the factors that influence DRSC coverage classes over time, and consider the implications of enhancing health systems in relation to DGCC/DRSC trajectories.

**Acknowledgements**

**Author contribution.**

**Conflict of interest**

Authors declared they have no conflicts of interest.

**Funding**

This study forms part of the authorâ€™s doctoral research, supported by a scholarship from the Chilean National Agency for Research and Development (ANID). Funding to present the results at academic conferences was provided by University College London (UCL). The funders had no role in the design, conduct, analysis, or reporting of the study.
